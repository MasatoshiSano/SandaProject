# 生産実績データサンプル生成 要件定義書

## 📋 概要

生産ラインの実績データを自動生成するコマンドを実装します。このコマンドは、既存の生産計画（Plan）と計画時間別生産数（計画PPH）に基づいて、現実的な生産実績データを生成します。

## 🎯 要求

- 生産実績データを自動生成するDjangoカスタムコマンドを実装する
- 生産計画と計画PPHに基づいて実績を生成する
- 不良品（NG）を0%から10%の範囲で含める
- 1日の総生産数を計画数の100-105%にする
- 計画されている機種順に生産を行う
- 機種切替時にダウンタイムを考慮する
- 実績の生産間隔は機種のサイクルタイムの100-110%とする
- 生産実績が翌日8:30を超えた場合、その日の生産を終了する
- 同一ライン内の全設備で同じデータを生成する
- 休憩時間中は生産を行わない（`WorkCalendar.break_times`に基づく）
- タイムゾーンは日本時間（JST）を使用

## 📝 機能仕様

### コマンド仕様

```bash
python manage.py seed_result_data [--line LINE_NUMBER] [--date YYYY-MM-DD] [--days NUMBER_OF_DAYS]
```

#### オプション
- `--line`: 対象ラインの番号（未指定時は全ライン）
- `--date`: 開始日（YYYY-MM-DD形式）
- `--days`: 生成する日数

### 生成ロジック

1. **生産計画の取得**
   - 指定された日付とラインの生産計画を取得
   - 計画PPHからサイクルタイムを算出
   - `WorkCalendar`から休憩時間情報を取得

2. **実績データの生成**
   - 既存データの削除：対象日の実績データを削除
   - 計画機種順に生産を行う
   - 各機種の生産:
     - サイクルタイム: 基準値の100-110%でランダム生成
     - 不良品率: 0-10%で単純ランダム生成
     - 総生産数: 計画数の100-105%に到達するまで生成
   
3. **タイミング制御**
   - 機種切替時のダウンタイム:
     - `PartChangeDowntime`から切替時間を取得
     - 未登録の場合は15分固定
   - `WorkCalendar.break_times`に基づく休憩時間中は生産を停止
   - 翌日8:30超過チェック
   - 超過時は生産終了

### 制約条件

- 生成される実績は`Result`モデルに保存
- 同一ライン内の全設備で同一データを使用
- 1日の生産は翌日8:30までに終了
- 既存の実績データは削除して新規生成
- タイムゾーンはJST（日本時間）に固定

### 休憩時間制御

- 各ラインの休憩時間は`WorkCalendar.break_times`から取得
- 休憩時間中は生産を一時停止
- 休憩終了後、停止していた地点から生産を再開

## 📊 データ要件

### 入力データ

- `Plan`モデル：生産計画データ
- `PlannedHourlyProduction`モデル：計画PPHデータ
- `PartChangeDowntime`モデル：機種切替時間データ
- `WorkCalendar`モデル：休憩時間データ

### 出力データ

`Result`モデルのフィールド：
- 生産日時（JST）
- ライン番号
- 設備番号
- 部品番号
- 生産数
- 不良品数
- その他必要なメタデータ

## 🔄 インタラクション

### モデル間の関連

- `Plan` → 生産計画の参照
- `PlannedHourlyProduction` → PPH情報の参照
- `PartChangeDowntime` → 機種切替時間の参照
- `WorkCalendar` → 休憩時間の参照
- `Result` → 生成データの保存

### ファイル構成

```
production/
  └── management/
      └── commands/
          └── seed_result_data.py
```

## ❓ 未解決の質問

1. 機種切替時のダウンタイムの具体的な時間設定
2. 不良品率の分布（均一か正規分布か）
3. 既存データが存在する場合の処理方針
4. 休憩時間の考慮要否
5. タイムゾーンの取り扱い 